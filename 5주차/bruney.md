# 타임라인 격리하기
> 시간에 따라 실행되는 액션의 순서를 나타내기 위해 타임라인 다이어그램에 대해 알아보기

## 타임라인 다이어그램은 시간에 따라 어떤 일이 일어나는지 보여줍니다.

> 타임라인은 액션을 순서대로 나열한 것, 타임라인 다이어그램은 시간에 따른 액션 순서를 시각적으로 표시한 것.

## 두 가지 타임라인 다이어그램 기본 규칙
순서대로 실행되는 액션, 동시에 나란히 실행되는 액션 두 가지가 중요한 사실. 두 종류의 액션을 시각화해 보면 코드가 올바르게 동작하는지 아니면 문제가 있는지 알 수 있음.

### 규칙
1. 두 액션이 순서대로 나타나면 같은 타임라인에 넣는다.
2. 두 액션이 동시에 실행되거나 순서를 예상할 수 없다면 분리된 타임라인에 넣는다.
- 서로 다른 스레드, 프로세스, 기계, 비동기 콜백에서 실행되면 서로 다른 타임라인에 표시 -> 액션 두 개가 서로 다른 비동기 콜백에서 실행됨.

### 요약
1. 액션은 순서대로 실행되거나 동시에 실행된다.
2. 순서대로 실행되는 액션은 같은 타임라인에서 하나가 끝나면 다른 하나가 실행된다.
3. 동시에 실행되는 액션은 여러 타임라인에서 나란히 실행된다.

## 타임라인 그리기: 단계 1
<img width="822" alt="스크린샷 2023-10-25 오후 10 49 45" src="https://github.com/kingyong9169/kingyong9169/assets/62797441/df627241-0aa2-451f-9cf2-63b1f3e63de2">

1. 액션을 확인
2. 순서대로 실행되거나 동시에 실행되는 액션 그리기
3. 플랫폼에 특화된 지식을 사용해 다이어그램 단순화 하기

## 비동기 호출은 새로운 타임라인으로 그리기

1. 액션 확인
<img width="799" alt="스크린샷 2023-10-25 오후 10 50 20" src="https://github.com/kingyong9169/kingyong9169/assets/62797441/e0615eba-0ec5-4168-9947-c503f4d3c759">


2. 액션 그리기
<img width="788" alt="스크린샷 2023-10-25 오후 11 12 22" src="https://github.com/kingyong9169/kingyong9169/assets/62797441/5a8f1832-13d1-48d2-938d-a2f7e11f9f8b">

- 콜백은 언제 실행될지 예측할 수 없기에 다른 타임라인으로 분리

## 서로 다른 언어, 서로 다른 스레드 모델
### 단일 스레드, 동기
php는 기본적으로 멀티스레드 지원 x, 모든 것이 순서대로 실행되고 입출력을 사용하면 끝날 때까지 기다려야 한다. 하지만 이런 제약은 시스템이 단순하다는 장점이기도 하다. 스레드가 하나면 타임라인도 하나이지만, 네트워크를 통한 API 호출 등 다른 타임라인도 필요하다. 하지만 메모리를 공유하지 않기 때문에 공유 자원을 많이 없앨 수 있다.

### 단일 스레드, 비동기
js는 단일 스레드. 입출력 작업을 하려면 비동기 모델을 사용해야 한다. 입출력의 결과는 콜백으로 받을 수 있지만, 언제 끝날지 알 수 없기 때문에 다른 타임라인에 표현해야 함.

### 멀티스레드
java, python, ruby, c, c#이 있음. 실행 순서를 보장하지 않기 때문에 프로그래밍하기 매우 어려움. 새로운 스레드가 생기면 새로운 타임라인을 그려야 함.

### 메시지 패싱 프로세스
엘릭서, 얼랭 같은 언어는 서로 다른 프로세스를 동시에 실행할 수 있는 스레드 모델을 지원. 프로세스는 서로 메모리를 공유하지 않고 메시지로 통신. 서로 다른 타임라인에 있는 액션은 순서가 섞이지만, 메모리를 공유하지 않기 때문에 가능한 실행 순서가 많아도 문제되지 않음.

## 타임라인 다이어그램으로 순서대로 실행되는 코드에도 두 가지 종류가 있다는 것을 알 수 있다.

<img width="535" alt="스크린샷 2023-10-25 오후 11 09 11" src="https://github.com/kingyong9169/kingyong9169/assets/62797441/a47d2eb8-81ce-44c6-b597-feeb7ee96cc4">

### 순서가 섞일 수 있는 코드
- 두 액션 사이에 시간은 얼마나 걸릴지 알 수 없다.
- 액션은 박스, 액션 사이에 걸리는 시간은 선으로 표시
- 액션과 액션 사이에 걸리는 시간에 따라 선을 길게 혹은 짧게 그릴 수 있음.
- 그렇다고 해도 두 액션 간 시간이 얼마나 걸릴지 알 수 없다.

### 순서가 섞이지 않는 코드
어떤 경우에는 두 액션이 차레로 실행되는데 그 사이에 다른 작업이 끼어들지 못한다.
- 하나의 상자에 두 액션을 넣는다.

## 좋은 타임라인의 원칙
> 타임라인을 사용하면서 좋은 타임라인의 원칙을 알면 코드를 개선하거나 더 이해하기 쉬운 코드를 만드는 데 도움이 된다. 실행 가능한 순서가 많다면 시스템을 이해하기 어렵다는 것을 잊지말 것.

1. 타임라인은 적을수록 이해하기 쉽다.
2. 타임라인은 짧을수록 이해하기 쉽다. -> 타임라인의 단계를 줄이는 것.
3. 공유하는 자원이 적을수록 이해하기 쉽다. -> 신경써야 할 실행 가능한 순서를 줄일 수 있다.
4. 자원을 공유한다면 서로 조율해야 한다. -> 안전하게 공유할 수 있어야 한다.(올바른 순서대로 자원을 쓰고 돌려준다.)
5. 시간을 일급으로 다룬다. -> 타임라인 다루는 재사용 가능한 객체를 만들면 타이밍 문제를 쉽게 만들 수 있다.

## JS의 단일 스레드
JS의 스레드 모델은 타임라인이 자원을 공유하면서 생기는 문제를 줄여준다. 하나의 메인 스레드만 있어서 대부분의 액션을 하나의 박스로 표현할 수 있다.

비동기 콜백을 함께 사용한다면 문제가 생길 수 있다. 비동기 호출은 미래에 알 수 없는 시점에 런타임에 의해 실행된다. 따라서 박스 사이의 선이 길어질 수도 짧아질 수도 있다. **JS에서 어떤 동작이 동기인지 비동기인지 아는 것이 중요하다.**

## JS의 비동기 큐
브라우저에서 동작하는 JS 엔진은 **작업 큐**라고 하는 큐를 가지고 있다. 작업 큐는 **이벤트 루프**에 의해 처리된다. 이벤트 루프는 큐에서 작업 하나를 꺼내 실행하고 완료되면 다음 작업을 꺼내 실행하는 것을 무한히 반복한다. 하나의 스레드에서 처리하기 때문에 두 개의 작업이 동시에 실행될 수 없다.

### 작업
이벤트 데이터와 이벤트를 처리할 콜백으로 구성되어 있다.

### 작업은 큐에 어떻게 들어가나요?
이벤트(마우스 클릭, 키보드 입력, AJAX 호출)가 발생하면 큐에 작업이 추가된다. **예측 불가능한 시점**에 작업 큐에 들어간다.

### 작업이 없을 때 엔진은 무엇을 하나요?
처리할 작업이 없을 때, 대기 상태로 들어가고 전원을 아낀다. GC작업을 하기도 한다. 하지만 이는 브라우저 개발자에게 달려 있다.

## 타임라인 단순화하기
1. 하나의 타임라인에 있는 모든 액션을 하나로 통합
2. 타임라인이 끝나는 곳에서 새로운 타임라인이 하나만 생긴다면 통합

<img width="820" alt="스크린샷 2023-10-26 오전 1 51 57 1" src="https://github.com/kingyong9169/kingyong9169/assets/62797441/0f4b33ac-b4cd-4954-a39d-7182828cc472">

첫 번째 타임라인이 끝나는 곳에 새로운 타임라인이 두 개 생기기 때문에 통합하지 않는다.
